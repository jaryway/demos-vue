!function(){var e=["timeoutInSeconds"],t=["grant_type","redirect_uri","client_id","client_secret"],r=["grant_type","client_id","client_secret","scope"],n=["grant_type","client_id","client_secret","timeoutInSeconds"],i=["url","authority","client_id","redirect_uri","response_type","scope","state_data","response_mode","request_type","client_secret","nonce","url_state","resource","skipUserInfo","extraQueryParams","extraTokenParams","disablePKCE"],s=["redirectMethod"],a=["popupWindowFeatures","popupWindowTarget"],o=["silentRequestTimeoutInSeconds"],c=["silentRequestTimeoutInSeconds"],u=["redirectMethod"],l=["popupWindowFeatures","popupWindowTarget"],h=["silentRequestTimeoutInSeconds"];function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t,r){return(t=O(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=N(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},v.apply(this,arguments)}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,s,a,o=[],c=!0,u=!1;try{if(s=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=s.call(r)).done)&&(o.push(n.value),o.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=S(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw s}}}}function m(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */m=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var s=t&&t.prototype instanceof w?t:w,a=Object.create(s.prototype),o=new U(n||[]);return i(a,"_invoke",{value:O(e,r,o)}),a}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",g="executing",_="completed",v={};function w(){}function y(){}function k(){}var b={};u(b,a,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(j([])));S&&S!==r&&n.call(S,a)&&(b=S);var E=k.prototype=w.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function r(i,s,a,o){var c=h(e[i],e,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==p(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,o)}),(function(e){r("throw",e,a,o)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,o)}))}o(c.arg)}var s;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return s=s?s.then(i,i):i()}})}function O(t,r,n){var i=d;return function(s,a){if(i===g)throw new Error("Generator is already running");if(i===_){if("throw"===s)throw a;return{value:e,done:!0}}for(n.method=s,n.arg=a;;){var o=n.delegate;if(o){var c=R(o,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===d)throw i=_,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=g;var u=h(t,r,n);if("normal"===u.type){if(i=n.done?_:f,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=_,n.method="throw",n.arg=u.arg)}}}function R(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,R(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var s=h(i,t.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,v;var a=s.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function U(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}throw new TypeError(p(t)+" is not iterable")}return y.prototype=k,i(E,"constructor",{value:k,configurable:!0}),i(k,"constructor",{value:y,configurable:!0}),y.displayName=u(k,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,u(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(I.prototype),u(I.prototype,o,(function(){return this})),t.AsyncIterator=I,t.async=function(e,r,n,i,s){void 0===s&&(s=Promise);var a=new I(l(e,r,n,i),s);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},T(E),u(E,c,"Generator"),u(E,a,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,U.prototype={constructor:U,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return o.type="throw",o.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function k(e,t,r,n,i,s,a){try{var o=e[s](a),c=o.value}catch(u){return void r(u)}o.done?t(c):Promise.resolve(c).then(n,i)}function b(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var s=e.apply(t,r);function a(e){k(s,n,i,a,o,"next",e)}function o(e){k(s,n,i,a,o,"throw",e)}a(void 0)}))}}function x(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,O(n.key),n)}}function I(e,t,r){return t&&T(e.prototype,t),r&&T(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function O(e){var t=function(e,t){if("object"!=p(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==p(t)?t:String(t)}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t,r){return t=N(t),function(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return C(e)}(e,A()?Reflect.construct(t,r||[],N(e).constructor):t.apply(e,r))}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}function j(e){var t="function"==typeof Map?new Map:void 0;return j=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(A())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&q(i,r.prototype),i}(e,arguments,N(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),q(r,e)},j(e)}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(A=function(){return!!e})()}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}function N(e){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},N(e)}System.register([],(function(d,g){"use strict";return{execute:function(){var g=function(e){function t(){return R(this,t),P(this,t,arguments)}return U(t,e),I(t)}(j(Error));function k(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(r){return atob(t)}}g.prototype.name="InvalidTokenError";var S,E,T,O={debug:function(){},info:function(){},warn:function(){},error:function(){}},A=d("L",function(e){return e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e}(A||{}));(T=A||d("L",A={})).reset=function(){S=3,E=O},T.setLevel=function(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");S=e},T.setLogger=function(e){E=e};var q=function(){function e(t){R(this,e),this._name=t}return I(e,[{key:"debug",value:function(){if(S>=4){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=E).debug.apply(t,[e._format(this._name,this._method)].concat(n))}}},{key:"info",value:function(){if(S>=3){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=E).info.apply(t,[e._format(this._name,this._method)].concat(n))}}},{key:"warn",value:function(){if(S>=2){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=E).warn.apply(t,[e._format(this._name,this._method)].concat(n))}}},{key:"error",value:function(){if(S>=1){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=E).error.apply(t,[e._format(this._name,this._method)].concat(n))}}},{key:"throw",value:function(e){throw this.error(e),e}},{key:"create",value:function(e){var t=Object.create(this);return t._method=e,t.debug("begin"),t}}],[{key:"createStatic",value:function(t,r){var n=new e("".concat(t,".").concat(r));return n.debug("begin"),n}},{key:"_format",value:function(e,t){var r="[".concat(e,"]");return t?"".concat(r," ").concat(t,":"):r}},{key:"debug",value:function(t){if(S>=4){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];(r=E).debug.apply(r,[e._format(t)].concat(i))}}},{key:"info",value:function(t){if(S>=3){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];(r=E).info.apply(r,[e._format(t)].concat(i))}}},{key:"warn",value:function(t){if(S>=2){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];(r=E).warn.apply(r,[e._format(t)].concat(i))}}},{key:"error",value:function(t){if(S>=1){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];(r=E).error.apply(r,[e._format(t)].concat(i))}}}]),e}();A.reset();var M=function(e){return btoa(x(new Uint8Array(e)).map((function(e){return String.fromCharCode(e)})).join(""))},L=function(){function e(){R(this,e)}var t;return I(e,null,[{key:"_randomWord",value:function(){var e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}},{key:"generateUUIDv4",value:function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(function(t){return(+t^e._randomWord()&15>>+t/4).toString(16)})).replace(/-/g,"")}},{key:"generateCodeVerifier",value:function(){return e.generateUUIDv4()+e.generateUUIDv4()+e.generateUUIDv4()}},{key:"generateCodeChallenge",value:(t=b(m().mark((function e(t){var r,n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(crypto.subtle){e.next=2;break}throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");case 2:return e.prev=2,r=new TextEncoder,n=r.encode(t),e.next=7,crypto.subtle.digest("SHA-256",n);case 7:return i=e.sent,e.abrupt("return",M(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""));case 11:throw e.prev=11,e.t0=e.catch(2),q.error("CryptoUtils.generateCodeChallenge",e.t0),e.t0;case 15:case"end":return e.stop()}}),e,null,[[2,11]])}))),function(e){return t.apply(this,arguments)})},{key:"generateBasicAuth",value:function(e,t){var r=(new TextEncoder).encode([e,t].join(":"));return M(r)}}]),e}(),H=function(){function e(t){R(this,e),this._name=t,this._logger=new q("Event('".concat(this._name,"')")),this._callbacks=[]}var t;return I(e,[{key:"addHandler",value:function(e){var t=this;return this._callbacks.push(e),function(){return t.removeHandler(e)}}},{key:"removeHandler",value:function(e){var t=this._callbacks.lastIndexOf(e);t>=0&&this._callbacks.splice(t,1)}},{key:"raise",value:(t=b(m().mark((function e(){var t,r,n,i,s,a,o,c=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=c.length,n=new Array(r),i=0;i<r;i++)n[i]=c[i];(t=this._logger).debug.apply(t,["raise:"].concat(n)),s=y(this._callbacks),e.prev=3,s.s();case 5:if((a=s.n()).done){e.next=11;break}return o=a.value,e.next=9,o.apply(void 0,n);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),s.e(e.t0);case 16:return e.prev=16,s.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])}))),function(){return t.apply(this,arguments)})}]),e}(),W=function(){function e(){R(this,e)}return I(e,null,[{key:"decode",value:function(e){try{return function(e,t){if("string"!=typeof e)throw new g("Invalid token specified: must be a string");t||(t={});var r,n=!0===t.header?0:1,i=e.split(".")[n];if("string"!=typeof i)throw new g("Invalid token specified: missing part #".concat(n+1));try{r=k(i)}catch(s){throw new g("Invalid token specified: invalid base64 for part #".concat(n+1," (").concat(s.message,")"))}try{return JSON.parse(r)}catch(s){throw new g("Invalid token specified: invalid json for part #".concat(n+1," (").concat(s.message,")"))}}(e)}catch(t){throw q.error("JwtUtils.decode",t),t}}}]),e}(),F=function(){function e(){R(this,e)}return I(e,null,[{key:"center",value:function(e){var t,r=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(e),e));return null==r.width&&(r.width=null!=(t=[800,720,600,480].find((function(e){return e<=window.outerWidth/1.618})))?t:360),null!=r.left||(r.left=Math.max(0,Math.round(window.screenX+(window.outerWidth-r.width)/2))),null!=r.height&&(null!=r.top||(r.top=Math.max(0,Math.round(window.screenY+(window.outerHeight-r.height)/2)))),r}},{key:"serialize",value:function(e){return Object.entries(e).filter((function(e){return null!=w(e,2)[1]})).map((function(e){var t=w(e,2),r=t[0],n=t[1];return"".concat(r,"=").concat("boolean"!=typeof n?n:n?"yes":"no")})).join(",")}}]),e}(),K=function(e){function t(){var e,r;return R(this,t),(r=P(this,t,arguments))._logger=new q("Timer('".concat(r._name,"')")),r._timerHandle=null,r._expiration=0,r._callback=function(){var n=r._expiration-t.getEpochTime();r._logger.debug("timer completes in",n),r._expiration<=t.getEpochTime()&&(r.cancel(),v((e=C(r),N(t.prototype)),"raise",e).call(e))},r}return U(t,e),I(t,[{key:"init",value:function(e){var r=this._logger.create("init");e=Math.max(Math.floor(e),1);var n=t.getEpochTime()+e;if(this.expiration===n&&this._timerHandle)r.debug("skipping since already initialized for expiration at",this.expiration);else{this.cancel(),r.debug("using duration",e),this._expiration=n;var i=Math.min(e,5);this._timerHandle=setInterval(this._callback,1e3*i)}}},{key:"expiration",get:function(){return this._expiration}},{key:"cancel",value:function(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}}],[{key:"getEpochTime",value:function(){return Math.floor(Date.now()/1e3)}}]),t}(H),J=function(){function e(){R(this,e)}return I(e,null,[{key:"readParams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"query";if(!e)throw new TypeError("Invalid URL");var r=new URL(e,"http://127.0.0.1")["fragment"===t?"hash":"search"];return new URLSearchParams(r.slice(1))}}]),e}(),z=function(e){function t(e,r){var n,i,s,a;if(R(this,t),(n=P(this,t,[e.error_description||e.error||""])).form=r,n.name="ErrorResponse",!e.error)throw q.error("ErrorResponse","No error passed"),new Error("No error passed");return n.error=e.error,n.error_description=null!=(i=e.error_description)?i:null,n.error_uri=null!=(s=e.error_uri)?s:null,n.state=e.userState,n.session_state=null!=(a=e.session_state)?a:null,n.url_state=e.url_state,n}return U(t,e),I(t)}(j(Error)),D=function(e){function t(e){var r;return R(this,t),(r=P(this,t,[e])).name="ErrorTimeout",r}return U(t,e),I(t)}(j(Error)),G=function(){function e(t){R(this,e),this._logger=new q("AccessTokenEvents"),this._expiringTimer=new K("Access token expiring"),this._expiredTimer=new K("Access token expired"),this._expiringNotificationTimeInSeconds=t.expiringNotificationTimeInSeconds}return I(e,[{key:"load",value:function(e){var t=this._logger.create("load");if(e.access_token&&void 0!==e.expires_in){var r=e.expires_in;if(t.debug("access token present, remaining duration:",r),r>0){var n=r-this._expiringNotificationTimeInSeconds;n<=0&&(n=1),t.debug("registering expiring timer, raising in",n,"seconds"),this._expiringTimer.init(n)}else t.debug("canceling existing expiring timer because we're past expiration."),this._expiringTimer.cancel();var i=r+1;t.debug("registering expired timer, raising in",i,"seconds"),this._expiredTimer.init(i)}else this._expiringTimer.cancel(),this._expiredTimer.cancel()}},{key:"unload",value:function(){this._logger.debug("unload: canceling existing access token timers"),this._expiringTimer.cancel(),this._expiredTimer.cancel()}},{key:"addAccessTokenExpiring",value:function(e){return this._expiringTimer.addHandler(e)}},{key:"removeAccessTokenExpiring",value:function(e){this._expiringTimer.removeHandler(e)}},{key:"addAccessTokenExpired",value:function(e){return this._expiredTimer.addHandler(e)}},{key:"removeAccessTokenExpired",value:function(e){this._expiredTimer.removeHandler(e)}}]),e}(),Q=function(){function e(t,r,n,i,s){var a=this;R(this,e),this._callback=t,this._client_id=r,this._intervalInSeconds=i,this._stopOnError=s,this._logger=new q("CheckSessionIFrame"),this._timer=null,this._session_state=null,this._message=function(e){e.origin===a._frame_origin&&e.source===a._frame.contentWindow&&("error"===e.data?(a._logger.error("error message from check session op iframe"),a._stopOnError&&a.stop()):"changed"===e.data?(a._logger.debug("changed message from check session op iframe"),a.stop(),a._callback()):a._logger.debug(e.data+" message from check session op iframe"))};var o=new URL(n);this._frame_origin=o.origin,this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="fixed",this._frame.style.left="-1000px",this._frame.style.top="0",this._frame.width="0",this._frame.height="0",this._frame.src=o.href}return I(e,[{key:"load",value:function(){var e=this;return new Promise((function(t){e._frame.onload=function(){t()},window.document.body.appendChild(e._frame),window.addEventListener("message",e._message,!1)}))}},{key:"start",value:function(e){var t=this;if(this._session_state!==e){this._logger.create("start"),this.stop(),this._session_state=e;var r=function(){t._frame.contentWindow&&t._session_state&&t._frame.contentWindow.postMessage(t._client_id+" "+t._session_state,t._frame_origin)};r(),this._timer=setInterval(r,1e3*this._intervalInSeconds)}}},{key:"stop",value:function(){this._logger.create("stop"),this._session_state=null,this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),B=function(){function e(){R(this,e),this._logger=new q("InMemoryWebStorage"),this._data={}}return I(e,[{key:"clear",value:function(){this._logger.create("clear"),this._data={}}},{key:"getItem",value:function(e){return this._logger.create("getItem('".concat(e,"')")),this._data[e]}},{key:"setItem",value:function(e,t){this._logger.create("setItem('".concat(e,"')")),this._data[e]=t}},{key:"removeItem",value:function(e){this._logger.create("removeItem('".concat(e,"')")),delete this._data[e]}},{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}},{key:"key",value:function(e){return Object.getOwnPropertyNames(this._data)[e]}}]),e}(),V=function(){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};R(this,t),this._jwtHandler=n,this._extraHeaders=i,this._logger=new q("JsonService"),this._contentTypes=[],(e=this._contentTypes).push.apply(e,x(r).concat(["application/json"])),n&&this._contentTypes.push("application/jwt")}var r,n,i;return I(t,[{key:"fetchWithTimeout",value:(i=b(m().mark((function t(r){var n,i,s,a,o,c,u=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=(n=u.length>1&&void 0!==u[1]?u[1]:{}).timeoutInSeconds,s=_(n,e),i){t.next=6;break}return t.next=5,fetch(r,s);case 5:return t.abrupt("return",t.sent);case 6:return a=new AbortController,o=setTimeout((function(){return a.abort()}),1e3*i),t.prev=8,t.next=11,fetch(r,f(f({},n),{},{signal:a.signal}));case 11:return c=t.sent,t.abrupt("return",c);case 15:if(t.prev=15,t.t0=t.catch(8),!(t.t0 instanceof DOMException&&"AbortError"===t.t0.name)){t.next=19;break}throw new D("Network timed out");case 19:throw t.t0;case 20:return t.prev=20,clearTimeout(o),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[8,15,20,23]])}))),function(e){return i.apply(this,arguments)})},{key:"getJson",value:(n=b(m().mark((function e(t){var r,n,i,s,a,o,c,u,l=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=l.length>1&&void 0!==l[1]?l[1]:{}).token,i=r.credentials,s=this._logger.create("getJson"),a={Accept:this._contentTypes.join(", ")},n&&(s.debug("token passed, setting Authorization header"),a.Authorization="Bearer "+n),this.appendExtraHeaders(a),e.prev=5,s.debug("url:",t),e.next=9,this.fetchWithTimeout(t,{method:"GET",headers:a,credentials:i});case 9:o=e.sent,e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(5),s.error("Network Error"),e.t0;case 16:if(s.debug("HTTP response received, status",o.status),(c=o.headers.get("Content-Type"))&&!this._contentTypes.find((function(e){return c.startsWith(e)}))&&s.throw(new Error("Invalid response Content-Type: ".concat(null!=c?c:"undefined",", from URL: ").concat(t))),!(o.ok&&this._jwtHandler&&(null==c?void 0:c.startsWith("application/jwt")))){e.next=27;break}return e.t1=this,e.next=23,o.text();case 23:return e.t2=e.sent,e.next=26,e.t1._jwtHandler.call(e.t1,e.t2);case 26:return e.abrupt("return",e.sent);case 27:return e.prev=27,e.next=30,o.json();case 30:u=e.sent,e.next=39;break;case 33:if(e.prev=33,e.t3=e.catch(27),s.error("Error parsing JSON response",e.t3),!o.ok){e.next=38;break}throw e.t3;case 38:throw new Error("".concat(o.statusText," (").concat(o.status,")"));case 39:if(o.ok){e.next=44;break}if(s.error("Error from server:",u),!u.error){e.next=43;break}throw new z(u);case 43:throw new Error("".concat(o.statusText," (").concat(o.status,"): ").concat(JSON.stringify(u)));case 44:return e.abrupt("return",u);case 45:case"end":return e.stop()}}),e,this,[[5,12],[27,33]])}))),function(e){return n.apply(this,arguments)})},{key:"postForm",value:(r=b(m().mark((function e(t,r){var n,i,s,a,o,c,u,l,h,p;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,i=r.basicAuth,s=r.timeoutInSeconds,a=r.initCredentials,o=this._logger.create("postForm"),c={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded"},void 0!==i&&(c.Authorization="Basic "+i),this.appendExtraHeaders(c),e.prev=5,o.debug("url:",t),e.next=9,this.fetchWithTimeout(t,{method:"POST",headers:c,body:n,timeoutInSeconds:s,credentials:a});case 9:u=e.sent,e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(5),o.error("Network error"),e.t0;case 16:if(o.debug("HTTP response received, status",u.status),!(l=u.headers.get("Content-Type"))||this._contentTypes.find((function(e){return l.startsWith(e)}))){e.next=20;break}throw new Error("Invalid response Content-Type: ".concat(null!=l?l:"undefined",", from URL: ").concat(t));case 20:return e.next=22,u.text();case 22:if(h=e.sent,p={},!h){e.next=35;break}e.prev=25,p=JSON.parse(h),e.next=35;break;case 29:if(e.prev=29,e.t1=e.catch(25),o.error("Error parsing JSON response",e.t1),!u.ok){e.next=34;break}throw e.t1;case 34:throw new Error("".concat(u.statusText," (").concat(u.status,")"));case 35:if(u.ok){e.next=40;break}if(o.error("Error from server:",p),!p.error){e.next=39;break}throw new z(p,n);case 39:throw new Error("".concat(u.statusText," (").concat(u.status,"): ").concat(JSON.stringify(p)));case 40:return e.abrupt("return",p);case 41:case"end":return e.stop()}}),e,this,[[5,12],[25,29]])}))),function(e,t){return r.apply(this,arguments)})},{key:"appendExtraHeaders",value:function(e){var t=this,r=this._logger.create("appendExtraHeaders"),n=Object.keys(this._extraHeaders),i=["authorization","accept","content-type"];0!==n.length&&n.forEach((function(n){if(i.includes(n.toLocaleLowerCase()))r.warn("Protected header could not be overridden",n,i);else{var s="function"==typeof t._extraHeaders[n]?t._extraHeaders[n]():t._extraHeaders[n];s&&""!==s&&(e[n]=s)}}))}}]),t}(),Y=function(){function e(t){R(this,e),this._settings=t,this._logger=new q("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new V(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}var t,r,n;return I(e,[{key:"resetSigningKeys",value:function(){this._signingKeys=null}},{key:"getMetadata",value:(n=b(m().mark((function e(){var t,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._logger.create("getMetadata"),!this._metadata){e.next=4;break}return t.debug("using cached values"),e.abrupt("return",this._metadata);case 4:if(this._metadataUrl){e.next=7;break}throw t.throw(new Error("No authority or metadataUrl configured on settings")),null;case 7:return t.debug("getting metadata from",this._metadataUrl),e.next=10,this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials});case 10:return r=e.sent,t.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,r),e.abrupt("return",this._metadata);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getIssuer",value:function(){return this._getMetadataProperty("issuer")}},{key:"getAuthorizationEndpoint",value:function(){return this._getMetadataProperty("authorization_endpoint")}},{key:"getUserInfoEndpoint",value:function(){return this._getMetadataProperty("userinfo_endpoint")}},{key:"getTokenEndpoint",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._getMetadataProperty("token_endpoint",e)}},{key:"getCheckSessionIframe",value:function(){return this._getMetadataProperty("check_session_iframe",!0)}},{key:"getEndSessionEndpoint",value:function(){return this._getMetadataProperty("end_session_endpoint",!0)}},{key:"getRevocationEndpoint",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._getMetadataProperty("revocation_endpoint",e)}},{key:"getKeysEndpoint",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._getMetadataProperty("jwks_uri",e)}},{key:"_getMetadataProperty",value:(r=b(m().mark((function e(t){var r,n,i,s=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]&&s[1],n=this._logger.create("_getMetadataProperty('".concat(t,"')")),e.next=4,this.getMetadata();case 4:if(i=e.sent,n.debug("resolved"),void 0!==i[t]){e.next=11;break}if(!0!==r){e.next=10;break}return n.warn("Metadata does not contain optional property"),e.abrupt("return",void 0);case 10:n.throw(new Error("Metadata does not contain property "+t));case 11:return e.abrupt("return",i[t]);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getSigningKeys",value:(t=b(m().mark((function e(){var t,r,n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._logger.create("getSigningKeys"),!this._signingKeys){e.next=4;break}return t.debug("returning signingKeys from cache"),e.abrupt("return",this._signingKeys);case 4:return e.next=6,this.getKeysEndpoint(!1);case 6:return r=e.sent,t.debug("got jwks_uri",r),e.next=10,this._jsonService.getJson(r);case 10:if(n=e.sent,t.debug("got key set",n),Array.isArray(n.keys)){e.next=15;break}throw t.throw(new Error("Missing keys on keyset")),null;case 15:return this._signingKeys=n.keys,e.abrupt("return",this._signingKeys);case 17:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),$=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.prefix,n=void 0===r?"oidc.":r,i=t.store,s=void 0===i?localStorage:i;R(this,e),this._logger=new q("WebStorageStateStore"),this._store=s,this._prefix=n}var t,r,n,i;return I(e,[{key:"set",value:(i=b(m().mark((function e(t,r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.create("set('".concat(t,"')")),t=this._prefix+t,e.next=4,this._store.setItem(t,r);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"get",value:(n=b(m().mark((function e(t){var r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.create("get('".concat(t,"')")),t=this._prefix+t,e.next=4,this._store.getItem(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"remove",value:(r=b(m().mark((function e(t){var r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.create("remove('".concat(t,"')")),t=this._prefix+t,e.next=4,this._store.getItem(t);case 4:return r=e.sent,e.next=7,this._store.removeItem(t);case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getAllKeys",value:(t=b(m().mark((function e(){var t,r,n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.create("getAllKeys"),e.next=3,this._store.length;case 3:t=e.sent,r=[],n=0;case 6:if(!(n<t)){e.next=14;break}return e.next=9,this._store.key(n);case 9:(i=e.sent)&&0===i.indexOf(this._prefix)&&r.push(i.substr(this._prefix.length));case 11:n++,e.next=6;break;case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),X=I((function e(t){var r=t.authority,n=t.metadataUrl,i=t.metadata,s=t.signingKeys,a=t.metadataSeed,o=t.client_id,c=t.client_secret,u=t.response_type,l=void 0===u?"code":u,h=t.scope,p=void 0===h?"openid":h,d=t.redirect_uri,f=t.post_logout_redirect_uri,g=t.client_authentication,_=void 0===g?"client_secret_post":g,v=t.prompt,w=t.display,y=t.max_age,m=t.ui_locales,k=t.acr_values,b=t.resource,x=t.response_mode,S=t.filterProtocolClaims,E=void 0===S||S,T=t.loadUserInfo,I=void 0!==T&&T,O=t.staleStateAgeInSeconds,P=void 0===O?900:O,C=t.mergeClaimsStrategy,U=void 0===C?{array:"replace"}:C,j=t.disablePKCE,A=void 0!==j&&j,q=t.stateStore,N=t.revokeTokenAdditionalContentTypes,M=t.fetchRequestCredentials,L=t.refreshTokenAllowedScope,H=t.extraQueryParams,W=void 0===H?{}:H,F=t.extraTokenParams,K=void 0===F?{}:F,J=t.extraHeaders,z=void 0===J?{}:J;if(R(this,e),this.authority=r,n?this.metadataUrl=n:(this.metadataUrl=r,r&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=i,this.metadataSeed=a,this.signingKeys=s,this.client_id=o,this.client_secret=c,this.response_type=l,this.scope=p,this.redirect_uri=d,this.post_logout_redirect_uri=f,this.client_authentication=_,this.prompt=v,this.display=w,this.max_age=y,this.ui_locales=m,this.acr_values=k,this.resource=b,this.response_mode=x,this.filterProtocolClaims=null==E||E,this.loadUserInfo=!!I,this.staleStateAgeInSeconds=P,this.mergeClaimsStrategy=U,this.disablePKCE=!!A,this.revokeTokenAdditionalContentTypes=N,this.fetchRequestCredentials=M||"same-origin",q)this.stateStore=q;else{var D="undefined"!=typeof window?window.localStorage:new B;this.stateStore=new $({store:D})}this.refreshTokenAllowedScope=L,this.extraQueryParams=W,this.extraTokenParams=K,this.extraHeaders=z})),Z=function(){function e(t,r){var n=this;R(this,e),this._settings=t,this._metadataService=r,this._logger=new q("UserInfoService"),this._getClaimsFromJwt=function(){var e=b(m().mark((function e(t){var r,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n._logger.create("_getClaimsFromJwt"),e.prev=1,i=W.decode(t),r.debug("JWT decoding successful"),e.abrupt("return",i);case 7:throw e.prev=7,e.t0=e.catch(1),r.error("Error parsing JWT response"),e.t0;case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),this._jsonService=new V(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}var t;return I(e,[{key:"getClaims",value:(t=b(m().mark((function e(t){var r,n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._logger.create("getClaims"),t||this._logger.throw(new Error("No token passed")),e.next=4,this._metadataService.getUserInfoEndpoint();case 4:return n=e.sent,r.debug("got userinfo url",n),e.next=8,this._jsonService.getJson(n,{token:t,credentials:this._settings.fetchRequestCredentials});case 8:return i=e.sent,r.debug("got claims",i),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),ee=function(){function e(t,r){R(this,e),this._settings=t,this._metadataService=r,this._logger=new q("TokenClient"),this._jsonService=new V(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}var i,s,a,o;return I(e,[{key:"exchangeCode",value:(o=b(m().mark((function e(r){var n,i,s,a,o,c,u,l,h,p,d,f,g,v,y,k,b,x,S;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=r.grant_type,i=void 0===n?"authorization_code":n,s=r.redirect_uri,a=void 0===s?this._settings.redirect_uri:s,o=r.client_id,c=void 0===o?this._settings.client_id:o,u=r.client_secret,l=void 0===u?this._settings.client_secret:u,h=_(r,t),p=this._logger.create("exchangeCode"),c||p.throw(new Error("A client_id is required")),a||p.throw(new Error("A redirect_uri is required")),h.code||p.throw(new Error("A code is required")),d=new URLSearchParams({grant_type:i,redirect_uri:a}),f=0,g=Object.entries(h);f<g.length;f++)v=w(g[f],2),y=v[0],null!=(k=v[1])&&d.set(y,k);e.t0=this._settings.client_authentication,e.next="client_secret_basic"===e.t0?10:"client_secret_post"===e.t0?15:18;break;case 10:if(l){e.next=13;break}throw p.throw(new Error("A client_secret is required")),null;case 13:return b=L.generateBasicAuth(c,l),e.abrupt("break",18);case 15:return d.append("client_id",c),l&&d.append("client_secret",l),e.abrupt("break",18);case 18:return e.next=20,this._metadataService.getTokenEndpoint(!1);case 20:return x=e.sent,p.debug("got token endpoint"),e.next=24,this._jsonService.postForm(x,{body:d,basicAuth:b,initCredentials:this._settings.fetchRequestCredentials});case 24:return S=e.sent,p.debug("got response"),e.abrupt("return",S);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"exchangeCredentials",value:(a=b(m().mark((function e(t){var n,i,s,a,o,c,u,l,h,p,d,f,g,v,y,k,b,x,S;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.grant_type,i=void 0===n?"password":n,s=t.client_id,a=void 0===s?this._settings.client_id:s,o=t.client_secret,c=void 0===o?this._settings.client_secret:o,u=t.scope,l=void 0===u?this._settings.scope:u,h=_(t,r),p=this._logger.create("exchangeCredentials"),a||p.throw(new Error("A client_id is required")),d=new URLSearchParams({grant_type:i,scope:l}),f=0,g=Object.entries(h);f<g.length;f++)v=w(g[f],2),y=v[0],null!=(k=v[1])&&d.set(y,k);e.t0=this._settings.client_authentication,e.next="client_secret_basic"===e.t0?8:"client_secret_post"===e.t0?13:16;break;case 8:if(c){e.next=11;break}throw p.throw(new Error("A client_secret is required")),null;case 11:return b=L.generateBasicAuth(a,c),e.abrupt("break",16);case 13:return d.append("client_id",a),c&&d.append("client_secret",c),e.abrupt("break",16);case 16:return e.next=18,this._metadataService.getTokenEndpoint(!1);case 18:return x=e.sent,p.debug("got token endpoint"),e.next=22,this._jsonService.postForm(x,{body:d,basicAuth:b,initCredentials:this._settings.fetchRequestCredentials});case 22:return S=e.sent,p.debug("got response"),e.abrupt("return",S);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"exchangeRefreshToken",value:(s=b(m().mark((function e(t){var r,i,s,a,o,c,u,l,h,p,d,f,g,v,y,k;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.grant_type,i=void 0===r?"refresh_token":r,s=t.client_id,a=void 0===s?this._settings.client_id:s,o=t.client_secret,c=void 0===o?this._settings.client_secret:o,u=t.timeoutInSeconds,l=_(t,n),h=this._logger.create("exchangeRefreshToken"),a||h.throw(new Error("A client_id is required")),l.refresh_token||h.throw(new Error("A refresh_token is required")),p=new URLSearchParams({grant_type:i}),d=m().mark((function e(){var t,r,n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=w(g[f],2),r=t[0],n=t[1],Array.isArray(n)?n.forEach((function(e){return p.append(r,e)})):null!=n&&p.set(r,n);case 2:case"end":return e.stop()}}),e)})),f=0,g=Object.entries(l);case 7:if(!(f<g.length)){e.next=12;break}return e.delegateYield(d(),"t0",9);case 9:f++,e.next=7;break;case 12:e.t1=this._settings.client_authentication,e.next="client_secret_basic"===e.t1?15:"client_secret_post"===e.t1?20:23;break;case 15:if(c){e.next=18;break}throw h.throw(new Error("A client_secret is required")),null;case 18:return v=L.generateBasicAuth(a,c),e.abrupt("break",23);case 20:return p.append("client_id",a),c&&p.append("client_secret",c),e.abrupt("break",23);case 23:return e.next=25,this._metadataService.getTokenEndpoint(!1);case 25:return y=e.sent,h.debug("got token endpoint"),e.next=29,this._jsonService.postForm(y,{body:p,basicAuth:v,timeoutInSeconds:u,initCredentials:this._settings.fetchRequestCredentials});case 29:return k=e.sent,h.debug("got response"),e.abrupt("return",k);case 32:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"revoke",value:(i=b(m().mark((function e(t){var r,n,i,s,a,o,c,u,l;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._logger.create("revoke"),t.token||n.throw(new Error("A token is required")),e.next=4,this._metadataService.getRevocationEndpoint(!1);case 4:for(i=e.sent,n.debug("got revocation endpoint, revoking ".concat(null!=(r=t.token_type_hint)?r:"default token type")),s=new URLSearchParams,a=0,o=Object.entries(t);a<o.length;a++)c=w(o[a],2),u=c[0],null!=(l=c[1])&&s.set(u,l);return s.set("client_id",this._settings.client_id),this._settings.client_secret&&s.set("client_secret",this._settings.client_secret),e.next=12,this._jsonService.postForm(i,{body:s});case 12:n.debug("got response");case 13:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}]),e}(),te=function(){function e(t,r,n){R(this,e),this._settings=t,this._metadataService=r,this._claimsService=n,this._logger=new q("ResponseValidator"),this._userInfoService=new Z(this._settings,this._metadataService),this._tokenClient=new ee(this._settings,this._metadataService)}var t,r,n,i,s;return I(e,[{key:"validateSigninResponse",value:(s=b(m().mark((function e(t,r){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._logger.create("validateSigninResponse"),this._processSigninState(t,r),n.debug("state processed"),e.next=5,this._processCode(t,r);case 5:return n.debug("code processed"),t.isOpenId&&this._validateIdTokenAttributes(t),n.debug("tokens validated"),e.next=10,this._processClaims(t,null==r?void 0:r.skipUserInfo,t.isOpenId);case 10:n.debug("claims processed");case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"validateCredentialsResponse",value:(i=b(m().mark((function e(t,r){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._logger.create("validateCredentialsResponse"),t.isOpenId&&t.id_token&&this._validateIdTokenAttributes(t),n.debug("tokens validated"),e.next=5,this._processClaims(t,r,t.isOpenId);case 5:n.debug("claims processed");case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"validateRefreshResponse",value:(n=b(m().mark((function e(t,r){var n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._logger.create("validateRefreshResponse"),t.userState=r.data,null!=t.session_state||(t.session_state=r.session_state),null!=t.scope||(t.scope=r.scope),t.isOpenId&&t.id_token&&(this._validateIdTokenAttributes(t,r.id_token),n.debug("ID Token validated")),t.id_token||(t.id_token=r.id_token,t.profile=r.profile),i=t.isOpenId&&!!t.id_token,e.next=9,this._processClaims(t,!1,i);case 9:n.debug("claims processed");case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"validateSignoutResponse",value:function(e,t){var r=this._logger.create("validateSignoutResponse");if(t.id!==e.state&&r.throw(new Error("State does not match")),r.debug("state validated"),e.userState=t.data,e.error)throw r.warn("Response was error",e.error),new z(e)}},{key:"_processSigninState",value:function(e,t){var r=this._logger.create("_processSigninState");if(t.id!==e.state&&r.throw(new Error("State does not match")),t.client_id||r.throw(new Error("No client_id on state")),t.authority||r.throw(new Error("No authority on state")),this._settings.authority!==t.authority&&r.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==t.client_id&&r.throw(new Error("client_id mismatch on settings vs. signin state")),r.debug("state validated"),e.userState=t.data,e.url_state=t.url_state,null!=e.scope||(e.scope=t.scope),e.error)throw r.warn("Response was error",e.error),new z(e);t.code_verifier&&!e.code&&r.throw(new Error("Expected code in response"))}},{key:"_processClaims",value:(r=b(m().mark((function e(t){var r,n,i,s,a=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>1&&void 0!==a[1]&&a[1],n=!(a.length>2&&void 0!==a[2])||a[2],i=this._logger.create("_processClaims"),t.profile=this._claimsService.filterProtocolClaims(t.profile),!r&&this._settings.loadUserInfo&&t.access_token){e.next=7;break}return i.debug("not loading user info"),e.abrupt("return");case 7:return i.debug("loading user info"),e.next=10,this._userInfoService.getClaims(t.access_token);case 10:s=e.sent,i.debug("user info claims received from user info endpoint"),n&&s.sub!==t.profile.sub&&i.throw(new Error("subject from UserInfo response does not match subject in ID Token")),t.profile=this._claimsService.mergeClaims(t.profile,this._claimsService.filterProtocolClaims(s)),i.debug("user info claims received, updated profile:",t.profile);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_processCode",value:(t=b(m().mark((function e(t,r){var n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._logger.create("_processCode"),!t.code){e.next=9;break}return n.debug("Validating code"),e.next=5,this._tokenClient.exchangeCode(f({client_id:r.client_id,client_secret:r.client_secret,code:t.code,redirect_uri:r.redirect_uri,code_verifier:r.code_verifier},r.extraTokenParams));case 5:i=e.sent,Object.assign(t,i),e.next=10;break;case 9:n.debug("No code to process");case 10:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"_validateIdTokenAttributes",value:function(e,t){var r,n=this._logger.create("_validateIdTokenAttributes");n.debug("decoding ID Token JWT");var i=W.decode(null!=(r=e.id_token)?r:"");if(i.sub||n.throw(new Error("ID Token is missing a subject claim")),t){var s=W.decode(t);i.sub!==s.sub&&n.throw(new Error("sub in id_token does not match current sub")),i.auth_time&&i.auth_time!==s.auth_time&&n.throw(new Error("auth_time in id_token does not match original auth_time")),i.azp&&i.azp!==s.azp&&n.throw(new Error("azp in id_token does not match original azp")),!i.azp&&s.azp&&n.throw(new Error("azp not in id_token, but present in original id_token"))}e.profile=i}}]),e}(),re=function(){function e(t){R(this,e),this.id=t.id||L.generateUUIDv4(),this.data=t.data,t.created&&t.created>0?this.created=t.created:this.created=K.getEpochTime(),this.request_type=t.request_type,this.url_state=t.url_state}var t;return I(e,[{key:"toStorageString",value:function(){return new q("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}}],[{key:"fromStorageString",value:function(t){return q.createStatic("State","fromStorageString"),Promise.resolve(new e(JSON.parse(t)))}},{key:"clearStaleState",value:(t=b(m().mark((function t(r,n){var i,s,a,o,c,u,l,h;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=q.createStatic("State","clearStaleState"),s=K.getEpochTime()-n,t.next=4,r.getAllKeys();case 4:a=t.sent,i.debug("got keys",a),o=0;case 7:if(!(o<a.length)){t.next=34;break}return c=a[o],t.next=11,r.get(c);case 11:if(u=t.sent,l=!1,!u){t.next=28;break}return t.prev=14,t.next=17,e.fromStorageString(u);case 17:h=t.sent,i.debug("got item from key:",c,h.created),h.created<=s&&(l=!0),t.next=26;break;case 22:t.prev=22,t.t0=t.catch(14),i.error("Error parsing state for key:",c,t.t0),l=!0;case 26:t.next=30;break;case 28:i.debug("no item in storage for key:",c),l=!0;case 30:l&&(i.debug("removed item for key:",c),r.remove(c));case 31:o++,t.next=7;break;case 34:case"end":return t.stop()}}),t,null,[[14,22]])}))),function(e,r){return t.apply(this,arguments)})}]),e}(),ne=function(e){function t(e){var r;return R(this,t),(r=P(this,t,[e])).code_verifier=e.code_verifier,r.code_challenge=e.code_challenge,r.authority=e.authority,r.client_id=e.client_id,r.redirect_uri=e.redirect_uri,r.scope=e.scope,r.client_secret=e.client_secret,r.extraTokenParams=e.extraTokenParams,r.response_mode=e.response_mode,r.skipUserInfo=e.skipUserInfo,r}var r;return U(t,e),I(t,[{key:"toStorageString",value:function(){return new q("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}}],[{key:"create",value:(r=b(m().mark((function e(r){var n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=!0===r.code_verifier?L.generateCodeVerifier():r.code_verifier||void 0)){e.next=7;break}return e.next=4,L.generateCodeChallenge(n);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=void 0;case 8:return i=e.t0,e.abrupt("return",new t(f(f({},r),{},{code_verifier:n,code_challenge:i})));case 10:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"fromStorageString",value:function(e){q.createStatic("SigninState","fromStorageString");var r=JSON.parse(e);return t.create(r)}}]),t}(re),ie=function(){function e(t){R(this,e),this.url=t.url,this.state=t.state}var t;return I(e,null,[{key:"create",value:(t=b(m().mark((function t(r){var n,s,a,o,c,u,l,h,p,d,g,v,y,k,b,x,S,E,T,I,O,R,P,C,U,j;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.url,s=r.authority,a=r.client_id,o=r.redirect_uri,c=r.response_type,u=r.scope,l=r.state_data,h=r.response_mode,p=r.request_type,d=r.client_secret,g=r.nonce,v=r.url_state,y=r.resource,k=r.skipUserInfo,b=r.extraQueryParams,x=r.extraTokenParams,S=r.disablePKCE,E=_(r,i),n){t.next=4;break}throw this._logger.error("create: No url passed"),new Error("url");case 4:if(a){t.next=7;break}throw this._logger.error("create: No client_id passed"),new Error("client_id");case 7:if(o){t.next=10;break}throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");case 10:if(c){t.next=13;break}throw this._logger.error("create: No response_type passed"),new Error("response_type");case 13:if(u){t.next=16;break}throw this._logger.error("create: No scope passed"),new Error("scope");case 16:if(s){t.next=19;break}throw this._logger.error("create: No authority passed"),new Error("authority");case 19:return t.next=21,ne.create({data:l,request_type:p,url_state:v,code_verifier:!S,client_id:a,authority:s,redirect_uri:o,response_mode:h,client_secret:d,scope:u,extraTokenParams:x,skipUserInfo:k});case 21:for(T=t.sent,(I=new URL(n)).searchParams.append("client_id",a),I.searchParams.append("redirect_uri",o),I.searchParams.append("response_type",c),I.searchParams.append("scope",u),g&&I.searchParams.append("nonce",g),O=T.id,v&&(O="".concat(O).concat(";").concat(v)),I.searchParams.append("state",O),T.code_challenge&&(I.searchParams.append("code_challenge",T.code_challenge),I.searchParams.append("code_challenge_method","S256")),y&&(Array.isArray(y)?y:[y]).forEach((function(e){return I.searchParams.append("resource",e)})),R=0,P=Object.entries(f(f({response_mode:h},E),b));R<P.length;R++)C=w(P[R],2),U=C[0],null!=(j=C[1])&&I.searchParams.append(U,j.toString());return t.abrupt("return",new e({url:I.href,state:T}));case 35:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})}]),e}();ie._logger=new q("SigninRequest");var se=ie,ae=function(){function e(t){if(R(this,e),this.access_token="",this.token_type="",this.profile={},this.state=t.get("state"),this.session_state=t.get("session_state"),this.state){var r=decodeURIComponent(this.state).split(";");this.state=r[0],r.length>1&&(this.url_state=r.slice(1).join(";"))}this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri"),this.code=t.get("code")}return I(e,[{key:"expires_in",get:function(){if(void 0!==this.expires_at)return this.expires_at-K.getEpochTime()},set:function(e){"string"==typeof e&&(e=Number(e)),void 0!==e&&e>=0&&(this.expires_at=Math.floor(e)+K.getEpochTime())}},{key:"isOpenId",get:function(){var e;return(null==(e=this.scope)?void 0:e.split(" ").includes("openid"))||!!this.id_token}}]),e}(),oe=I((function e(t){var r=t.url,n=t.state_data,i=t.id_token_hint,s=t.post_logout_redirect_uri,a=t.extraQueryParams,o=t.request_type,c=t.client_id;if(R(this,e),this._logger=new q("SignoutRequest"),!r)throw this._logger.error("ctor: No url passed"),new Error("url");var u=new URL(r);i&&u.searchParams.append("id_token_hint",i),c&&u.searchParams.append("client_id",c),s&&(u.searchParams.append("post_logout_redirect_uri",s),n&&(this.state=new re({data:n,request_type:o}),u.searchParams.append("state",this.state.id)));for(var l=0,h=Object.entries(f({},a));l<h.length;l++){var p=w(h[l],2),d=p[0],g=p[1];null!=g&&u.searchParams.append(d,g.toString())}this.url=u.href})),ce=I((function e(t){R(this,e),this.state=t.get("state"),this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri")})),ue=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],le=["sub","iss","aud","exp","iat"],he=function(){function e(t){R(this,e),this._settings=t,this._logger=new q("ClaimsService")}return I(e,[{key:"filterProtocolClaims",value:function(e){var t=f({},e);if(this._settings.filterProtocolClaims){var r,n=y(Array.isArray(this._settings.filterProtocolClaims)?this._settings.filterProtocolClaims:ue);try{for(n.s();!(r=n.n()).done;){var i=r.value;le.includes(i)||delete t[i]}}catch(s){n.e(s)}finally{n.f()}}return t}},{key:"mergeClaims",value:function(e,t){for(var r=f({},e),n=0,i=Object.entries(t);n<i.length;n++){var s=w(i[n],2),a=s[0],o=s[1];if(r[a]!==o)if(Array.isArray(r[a])||Array.isArray(o))if("replace"==this._settings.mergeClaimsStrategy.array)r[a]=o;else{var c,u=Array.isArray(r[a])?r[a]:[r[a]],l=y(Array.isArray(o)?o:[o]);try{for(l.s();!(c=l.n()).done;){var h=c.value;u.includes(h)||u.push(h)}}catch(d){l.e(d)}finally{l.f()}r[a]=u}else"object"===p(r[a])&&"object"===p(o)?r[a]=this.mergeClaims(r[a],o):r[a]=o}return r}}]),e}(),pe=function(){function e(t,r){R(this,e),this._logger=new q("OidcClient"),this.settings=t instanceof X?t:new X(t),this.metadataService=null!=r?r:new Y(this.settings),this._claimsService=new he(this.settings),this._validator=new te(this.settings,this.metadataService,this._claimsService),this._tokenClient=new ee(this.settings,this.metadataService)}var t,r,n,i,s,a,o,c,u;return I(e,[{key:"createSigninRequest",value:(u=b(m().mark((function e(t){var r,n,i,s,a,o,c,u,l,h,p,d,f,g,_,v,w,y,k,b,x,S,E,T,I,O,R,P,C,U,j,A,q,N,M,L,H;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.state,n=t.request,i=t.request_uri,s=t.request_type,a=t.id_token_hint,o=t.login_hint,c=t.skipUserInfo,u=t.nonce,l=t.url_state,h=t.response_type,p=void 0===h?this.settings.response_type:h,d=t.scope,f=void 0===d?this.settings.scope:d,g=t.redirect_uri,_=void 0===g?this.settings.redirect_uri:g,v=t.prompt,w=void 0===v?this.settings.prompt:v,y=t.display,k=void 0===y?this.settings.display:y,b=t.max_age,x=void 0===b?this.settings.max_age:b,S=t.ui_locales,E=void 0===S?this.settings.ui_locales:S,T=t.acr_values,I=void 0===T?this.settings.acr_values:T,O=t.resource,R=void 0===O?this.settings.resource:O,P=t.response_mode,C=void 0===P?this.settings.response_mode:P,U=t.extraQueryParams,j=void 0===U?this.settings.extraQueryParams:U,A=t.extraTokenParams,q=void 0===A?this.settings.extraTokenParams:A,N=this._logger.create("createSigninRequest"),"code"===p){e.next=4;break}throw new Error("Only the Authorization Code flow (with PKCE) is supported");case 4:return e.next=6,this.metadataService.getAuthorizationEndpoint();case 6:return M=e.sent,N.debug("Received authorization endpoint",M),e.next=10,se.create({url:M,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:_,response_type:p,scope:f,state_data:r,url_state:l,prompt:w,display:k,max_age:x,ui_locales:E,id_token_hint:a,login_hint:o,acr_values:I,resource:R,request:n,request_uri:i,extraQueryParams:j,extraTokenParams:q,request_type:s,response_mode:C,client_secret:this.settings.client_secret,skipUserInfo:c,nonce:u,disablePKCE:this.settings.disablePKCE});case 10:return L=e.sent,e.next=13,this.clearStaleState();case 13:return H=L.state,e.next=16,this.settings.stateStore.set(H.id,H.toStorageString());case 16:return e.abrupt("return",L);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"readSigninResponseState",value:(c=b(m().mark((function e(t){var r,n,i,s,a,o=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]&&o[1],n=this._logger.create("readSigninResponseState"),(i=new ae(J.readParams(t,this.settings.response_mode))).state){e.next=6;break}throw n.throw(new Error("No state in response")),null;case 6:return e.next=8,this.settings.stateStore[r?"remove":"get"](i.state);case 8:if(s=e.sent){e.next=12;break}throw n.throw(new Error("No matching state found in storage")),null;case 12:return e.next=14,ne.fromStorageString(s);case 14:return a=e.sent,e.abrupt("return",{state:a,response:i});case 16:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"processSigninResponse",value:(o=b(m().mark((function e(t){var r,n,i,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._logger.create("processSigninResponse"),e.next=3,this.readSigninResponseState(t,!0);case 3:return n=e.sent,i=n.state,s=n.response,r.debug("received state from storage; validating response"),e.next=9,this._validator.validateSigninResponse(s,i);case 9:return e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"processResourceOwnerPasswordCredentials",value:(a=b(m().mark((function e(t){var r,n,i,s,a,o,c,u;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.username,n=t.password,i=t.skipUserInfo,s=void 0!==i&&i,a=t.extraTokenParams,o=void 0===a?{}:a,e.next=3,this._tokenClient.exchangeCredentials(f({username:r,password:n},o));case 3:return c=e.sent,u=new ae(new URLSearchParams),Object.assign(u,c),e.next=8,this._validator.validateCredentialsResponse(u,s);case 8:return e.abrupt("return",u);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"useRefreshToken",value:(s=b(m().mark((function e(t){var r,n,i,s,a,o,c,u,l,h,p,d;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,n=t.redirect_uri,i=t.resource,s=t.timeoutInSeconds,a=t.extraTokenParams,c=this._logger.create("useRefreshToken"),void 0===this.settings.refreshTokenAllowedScope?u=r.scope:(l=this.settings.refreshTokenAllowedScope.split(" "),h=(null==(o=r.scope)?void 0:o.split(" "))||[],u=h.filter((function(e){return l.includes(e)})).join(" ")),e.next=5,this._tokenClient.exchangeRefreshToken(f({refresh_token:r.refresh_token,scope:u,redirect_uri:n,resource:i,timeoutInSeconds:s},a));case 5:return p=e.sent,d=new ae(new URLSearchParams),Object.assign(d,p),c.debug("validating response",d),e.next=11,this._validator.validateRefreshResponse(d,f(f({},r),{},{scope:u}));case 11:return e.abrupt("return",d);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"createSignoutRequest",value:(i=b(m().mark((function e(){var t,r,n,i,s,a,o,c,u,l,h,p,d,f=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t=f.length>0&&void 0!==f[0]?f[0]:{}).state,n=t.id_token_hint,i=t.client_id,s=t.request_type,a=t.post_logout_redirect_uri,o=void 0===a?this.settings.post_logout_redirect_uri:a,c=t.extraQueryParams,u=void 0===c?this.settings.extraQueryParams:c,l=this._logger.create("createSignoutRequest"),e.next=4,this.metadataService.getEndSessionEndpoint();case 4:if(h=e.sent){e.next=8;break}throw l.throw(new Error("No end session endpoint")),null;case 8:return l.debug("Received end session endpoint",h),i||!o||n||(i=this.settings.client_id),p=new oe({url:h,id_token_hint:n,client_id:i,post_logout_redirect_uri:o,state_data:r,extraQueryParams:u,request_type:s}),e.next=13,this.clearStaleState();case 13:if(!(d=p.state)){e.next=18;break}return l.debug("Signout request has state to persist"),e.next=18,this.settings.stateStore.set(d.id,d.toStorageString());case 18:return e.abrupt("return",p);case 19:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"readSignoutResponseState",value:(n=b(m().mark((function e(t){var r,n,i,s,a,o=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]&&o[1],n=this._logger.create("readSignoutResponseState"),(i=new ce(J.readParams(t,this.settings.response_mode))).state){e.next=9;break}if(n.debug("No state in response"),!i.error){e.next=8;break}throw n.warn("Response was error:",i.error),new z(i);case 8:return e.abrupt("return",{state:void 0,response:i});case 9:return e.next=11,this.settings.stateStore[r?"remove":"get"](i.state);case 11:if(s=e.sent){e.next=15;break}throw n.throw(new Error("No matching state found in storage")),null;case 15:return e.next=17,re.fromStorageString(s);case 17:return a=e.sent,e.abrupt("return",{state:a,response:i});case 19:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"processSignoutResponse",value:(r=b(m().mark((function e(t){var r,n,i,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._logger.create("processSignoutResponse"),e.next=3,this.readSignoutResponseState(t,!0);case 3:return n=e.sent,i=n.state,s=n.response,i?(r.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(s,i)):r.debug("No state from storage; skipping response validation"),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"clearStaleState",value:function(){return this._logger.create("clearStaleState"),re.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}},{key:"revokeToken",value:(t=b(m().mark((function e(t,r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.create("revokeToken"),e.next=3,this._tokenClient.revoke({token:t,token_type_hint:r});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),de=function(){function e(t){var r=this;R(this,e),this._userManager=t,this._logger=new q("SessionMonitor"),this._start=function(){var e=b(m().mark((function e(t){var n,i,s,a,o,c,u;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session_state){e.next=3;break}return e.abrupt("return");case 3:if(i=r._logger.create("_start"),t.profile?(r._sub=t.profile.sub,i.debug("session_state",n,", sub",r._sub)):(r._sub=void 0,i.debug("session_state",n,", anonymous user")),!r._checkSessionIFrame){e.next=8;break}return r._checkSessionIFrame.start(n),e.abrupt("return");case 8:return e.prev=8,e.next=11,r._userManager.metadataService.getCheckSessionIframe();case 11:if(!(s=e.sent)){e.next=24;break}return i.debug("initializing check session iframe"),a=r._userManager.settings.client_id,o=r._userManager.settings.checkSessionIntervalInSeconds,c=r._userManager.settings.stopCheckSessionOnError,u=new Q(r._callback,a,s,o,c),e.next=20,u.load();case 20:r._checkSessionIFrame=u,u.start(n),e.next=25;break;case 24:i.warn("no check session iframe found in the metadata");case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(8),i.error("Error from getCheckSessionIframe:",e.t0 instanceof Error?e.t0.message:e.t0);case 30:case"end":return e.stop()}}),e,null,[[8,27]])})));return function(t){return e.apply(this,arguments)}}(),this._stop=function(){var e=r._logger.create("_stop");if(r._sub=void 0,r._checkSessionIFrame&&r._checkSessionIFrame.stop(),r._userManager.settings.monitorAnonymousSession)var t=setInterval(b(m().mark((function n(){var i,s;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return clearInterval(t),n.prev=1,n.next=4,r._userManager.querySessionStatus();case 4:(i=n.sent)&&(s={session_state:i.session_state,profile:i.sub?{sub:i.sub}:null},r._start(s)),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),e.error("error from querySessionStatus",n.t0 instanceof Error?n.t0.message:n.t0);case 11:case"end":return n.stop()}}),n,null,[[1,8]])}))),1e3)},this._callback=b(m().mark((function e(){var t,n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r._logger.create("_callback"),e.prev=1,e.next=4,r._userManager.querySessionStatus();case 4:if(n=e.sent,i=!0,!n||!r._checkSessionIFrame){e.next=18;break}if(n.sub!==r._sub){e.next=15;break}return i=!1,r._checkSessionIFrame.start(n.session_state),t.debug("same sub still logged in at OP, session state has changed, restarting check session iframe; session_state",n.session_state),e.next=13,r._userManager.events._raiseUserSessionChanged();case 13:e.next=16;break;case 15:t.debug("different subject signed into OP",n.sub);case 16:e.next=19;break;case 18:t.debug("subject no longer signed into OP");case 19:if(!i){e.next=29;break}if(!r._sub){e.next=25;break}return e.next=23,r._userManager.events._raiseUserSignedOut();case 23:e.next=27;break;case 25:return e.next=27,r._userManager.events._raiseUserSignedIn();case 27:e.next=30;break;case 29:t.debug("no change in session detected, no event to raise");case 30:e.next=38;break;case 32:if(e.prev=32,e.t0=e.catch(1),!r._sub){e.next=38;break}return t.debug("Error calling queryCurrentSigninSession; raising signed out event",e.t0),e.next=38,r._userManager.events._raiseUserSignedOut();case 38:case"end":return e.stop()}}),e,null,[[1,32]])}))),t||this._logger.throw(new Error("No user manager passed")),this._userManager.events.addUserLoaded(this._start),this._userManager.events.addUserUnloaded(this._stop),this._init().catch((function(e){r._logger.error(e)}))}var t;return I(e,[{key:"_init",value:(t=b(m().mark((function e(){var t,r,n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.create("_init"),e.next=3,this._userManager.getUser();case 3:if(!(t=e.sent)){e.next=8;break}this._start(t),e.next=13;break;case 8:if(!this._userManager.settings.monitorAnonymousSession){e.next=13;break}return e.next=11,this._userManager.querySessionStatus();case 11:(r=e.sent)&&(n={session_state:r.session_state,profile:r.sub?{sub:r.sub}:null},this._start(n));case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),fe=function(){function e(t){var r;R(this,e),this.id_token=t.id_token,this.session_state=null!=(r=t.session_state)?r:null,this.access_token=t.access_token,this.refresh_token=t.refresh_token,this.token_type=t.token_type,this.scope=t.scope,this.profile=t.profile,this.expires_at=t.expires_at,this.state=t.userState,this.url_state=t.url_state}return I(e,[{key:"expires_in",get:function(){if(void 0!==this.expires_at)return this.expires_at-K.getEpochTime()},set:function(e){void 0!==e&&(this.expires_at=Math.floor(e)+K.getEpochTime())}},{key:"expired",get:function(){var e=this.expires_in;if(void 0!==e)return e<=0}},{key:"scopes",get:function(){var e,t;return null!=(t=null==(e=this.scope)?void 0:e.split(" "))?t:[]}},{key:"toStorageString",value:function(){return new q("User").create("toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})}}],[{key:"fromStorageString",value:function(t){return q.createStatic("User","fromStorageString"),new e(JSON.parse(t))}}]),e}(),ge="oidc-client",_e=function(){function e(){R(this,e),this._abort=new H("Window navigation aborted"),this._disposeHandlers=new Set,this._window=null}var t;return I(e,[{key:"navigate",value:(t=b(m().mark((function e(t){var r,n,i,s,a=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._logger.create("navigate"),this._window){e.next=3;break}throw new Error("Attempted to navigate on a disposed window");case 3:return r.debug("setting URL in window"),this._window.location.replace(t.url),e.next=7,new Promise((function(e,n){var i=function(i){var s,o=i.data,c=null!=(s=t.scriptOrigin)?s:window.location.origin;if(i.origin===c&&(null==o?void 0:o.source)===ge){try{var u=J.readParams(o.url,t.response_mode).get("state");if(u||r.warn("no state found in response url"),i.source!==a._window&&u!==t.state)return}catch(l){a._dispose(),n(new Error("Invalid response from window"))}e(o)}};window.addEventListener("message",i,!1),a._disposeHandlers.add((function(){return window.removeEventListener("message",i,!1)})),a._disposeHandlers.add(a._abort.addHandler((function(e){a._dispose(),n(e)})))}));case 7:return n=e.sent,i=n.url,s=n.keepOpen,r.debug("got response from window"),this._dispose(),s||this.close(),e.abrupt("return",{url:i});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_dispose",value:function(){this._logger.create("_dispose");var e,t=y(this._disposeHandlers);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(r){t.e(r)}finally{t.f()}this._disposeHandlers.clear()}}],[{key:"_notifyParent",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window.location.origin;e.postMessage({source:ge,url:t,keepOpen:r},n)}}]),e}(),ve={location:!1,toolbar:!1,height:640,closePopupWindowAfterInSeconds:-1},we="_blank",ye=function(e){function t(e){var r;R(this,t);var n=e.popup_redirect_uri,i=void 0===n?e.redirect_uri:n,s=e.popup_post_logout_redirect_uri,a=void 0===s?e.post_logout_redirect_uri:s,o=e.popupWindowFeatures,c=void 0===o?ve:o,u=e.popupWindowTarget,l=void 0===u?we:u,h=e.redirectMethod,p=void 0===h?"assign":h,d=e.redirectTarget,f=void 0===d?"self":d,g=e.iframeNotifyParentOrigin,_=void 0===g?e.iframeNotifyParentOrigin:g,v=e.iframeScriptOrigin,w=void 0===v?e.iframeScriptOrigin:v,y=e.silent_redirect_uri,m=void 0===y?e.redirect_uri:y,k=e.silentRequestTimeoutInSeconds,b=void 0===k?10:k,x=e.automaticSilentRenew,S=void 0===x||x,E=e.validateSubOnSilentRenew,T=void 0===E||E,I=e.includeIdTokenInSilentRenew,O=void 0!==I&&I,C=e.monitorSession,U=void 0!==C&&C,j=e.monitorAnonymousSession,A=void 0!==j&&j,q=e.checkSessionIntervalInSeconds,N=void 0===q?2:q,M=e.query_status_response_type,L=void 0===M?"code":M,H=e.stopCheckSessionOnError,W=void 0===H||H,F=e.revokeTokenTypes,K=void 0===F?["access_token","refresh_token"]:F,J=e.revokeTokensOnSignout,z=void 0!==J&&J,D=e.includeIdTokenInSilentSignout,G=void 0!==D&&D,Q=e.accessTokenExpiringNotificationTimeInSeconds,V=void 0===Q?60:Q,Y=e.userStore;if((r=P(this,t,[e])).popup_redirect_uri=i,r.popup_post_logout_redirect_uri=a,r.popupWindowFeatures=c,r.popupWindowTarget=l,r.redirectMethod=p,r.redirectTarget=f,r.iframeNotifyParentOrigin=_,r.iframeScriptOrigin=w,r.silent_redirect_uri=m,r.silentRequestTimeoutInSeconds=b,r.automaticSilentRenew=S,r.validateSubOnSilentRenew=T,r.includeIdTokenInSilentRenew=O,r.monitorSession=U,r.monitorAnonymousSession=A,r.checkSessionIntervalInSeconds=N,r.stopCheckSessionOnError=W,r.query_status_response_type=L,r.revokeTokenTypes=K,r.revokeTokensOnSignout=z,r.includeIdTokenInSilentSignout=G,r.accessTokenExpiringNotificationTimeInSeconds=V,Y)r.userStore=Y;else{var X="undefined"!=typeof window?window.sessionStorage:new B;r.userStore=new $({store:X})}return r}return U(t,e),I(t)}(X),me=function(e){function t(e){var r,n=e.silentRequestTimeoutInSeconds,i=void 0===n?10:n;return R(this,t),(r=P(this,t))._logger=new q("IFrameWindow"),r._timeoutInSeconds=i,r._frame=t.createHiddenIframe(),r._window=r._frame.contentWindow,r}var r;return U(t,e),I(t,[{key:"navigate",value:(r=b(m().mark((function e(r){var n,i=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.debug("navigate: Using timeout of:",this._timeoutInSeconds),n=setTimeout((function(){i._abort.raise(new D("IFrame timed out without a response"))}),1e3*this._timeoutInSeconds),this._disposeHandlers.add((function(){return clearTimeout(n)})),e.next=5,v(N(t.prototype),"navigate",this).call(this,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"close",value:function(){var e,t=this;this._frame&&(this._frame.parentNode&&(this._frame.addEventListener("load",(function(e){var r,n=e.target;null==(r=n.parentNode)||r.removeChild(n),t._abort.raise(new Error("IFrame removed from DOM"))}),!0),null==(e=this._frame.contentWindow)||e.location.replace("about:blank")),this._frame=null),this._window=null}}],[{key:"createHiddenIframe",value:function(){var e=window.document.createElement("iframe");return e.style.visibility="hidden",e.style.position="fixed",e.style.left="-1000px",e.style.top="0",e.width="0",e.height="0",window.document.body.appendChild(e),e}},{key:"notifyParent",value:function(e,r){return v(N(t),"_notifyParent",this).call(this,window.parent,e,!1,r)}}]),t}(_e),ke=function(){function e(t){R(this,e),this._settings=t,this._logger=new q("IFrameNavigator")}var t,r;return I(e,[{key:"prepare",value:(r=b(m().mark((function e(t){var r,n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.silentRequestTimeoutInSeconds,n=void 0===r?this._settings.silentRequestTimeoutInSeconds:r,e.abrupt("return",new me({silentRequestTimeoutInSeconds:n}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"callback",value:(t=b(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._logger.create("callback"),me.notifyParent(t,this._settings.iframeNotifyParentOrigin);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),be=function(e){function t(e){var r,n=e.popupWindowTarget,i=void 0===n?we:n,s=e.popupWindowFeatures,a=void 0===s?{}:s;R(this,t),(r=P(this,t))._logger=new q("PopupWindow");var o=F.center(f(f({},ve),a));return r._window=window.open(void 0,i,F.serialize(o)),a.closePopupWindowAfterInSeconds&&a.closePopupWindowAfterInSeconds>0&&setTimeout((function(){r._window&&"boolean"==typeof r._window.closed&&!r._window.closed?r.close():r._abort.raise(new Error("Popup blocked by user"))}),1e3*a.closePopupWindowAfterInSeconds),r}var r;return U(t,e),I(t,[{key:"navigate",value:(r=b(m().mark((function e(r){var n,i,s=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==(n=this._window)||n.focus(),i=setInterval((function(){s._window&&!s._window.closed||s._abort.raise(new Error("Popup closed by user"))}),500),this._disposeHandlers.add((function(){return clearInterval(i)})),e.next=5,v(N(t.prototype),"navigate",this).call(this,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"close",value:function(){this._window&&(this._window.closed||(this._window.close(),this._abort.raise(new Error("Popup closed")))),this._window=null}}],[{key:"notifyOpener",value:function(e,r){if(!window.opener)throw new Error("No window.opener. Can't complete notification.");return v(N(t),"_notifyParent",this).call(this,window.opener,e,r)}}]),t}(_e),xe=function(){function e(t){R(this,e),this._settings=t,this._logger=new q("PopupNavigator")}var t,r;return I(e,[{key:"prepare",value:(r=b(m().mark((function e(t){var r,n,i,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.popupWindowFeatures,n=void 0===r?this._settings.popupWindowFeatures:r,i=t.popupWindowTarget,s=void 0===i?this._settings.popupWindowTarget:i,e.abrupt("return",new be({popupWindowFeatures:n,popupWindowTarget:s}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"callback",value:(t=b(m().mark((function e(t,r){var n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.keepOpen,i=void 0!==n&&n,this._logger.create("callback"),be.notifyOpener(t,i);case 3:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),Se=function(){function e(t){R(this,e),this._settings=t,this._logger=new q("RedirectNavigator")}var t,r;return I(e,[{key:"prepare",value:(r=b(m().mark((function e(t){var r,n,i,s,a,o,c,u,l=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.redirectMethod,n=void 0===r?this._settings.redirectMethod:r,i=t.redirectTarget,s=void 0===i?this._settings.redirectTarget:i,this._logger.create("prepare"),o=window.self,"top"===s&&(o=null!=(a=window.top)?a:window.self),c=o.location[n].bind(o.location),e.abrupt("return",{navigate:function(){var e=b(m().mark((function e(t){var r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l._logger.create("navigate"),r=new Promise((function(e,t){u=t})),c(t.url),e.next=5,r;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),close:function(){l._logger.create("close"),null==u||u(new Error("Redirect aborted")),o.stop()}});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"callback",value:(t=b(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}(),Ee=function(e){function t(e){var r;return R(this,t),(r=P(this,t,[{expiringNotificationTimeInSeconds:e.accessTokenExpiringNotificationTimeInSeconds}]))._logger=new q("UserManagerEvents"),r._userLoaded=new H("User loaded"),r._userUnloaded=new H("User unloaded"),r._silentRenewError=new H("Silent renew error"),r._userSignedIn=new H("User signed in"),r._userSignedOut=new H("User signed out"),r._userSessionChanged=new H("User session changed"),r}var r,n,i,s,a,o;return U(t,e),I(t,[{key:"load",value:(o=b(m().mark((function e(r){var n,i=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(i.length>1&&void 0!==i[1])||i[1],v(N(t.prototype),"load",this).call(this,r),!n){e.next=5;break}return e.next=5,this._userLoaded.raise(r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"unload",value:(a=b(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(N(t.prototype),"unload",this).call(this),e.next=3,this._userUnloaded.raise();case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"addUserLoaded",value:function(e){return this._userLoaded.addHandler(e)}},{key:"removeUserLoaded",value:function(e){return this._userLoaded.removeHandler(e)}},{key:"addUserUnloaded",value:function(e){return this._userUnloaded.addHandler(e)}},{key:"removeUserUnloaded",value:function(e){return this._userUnloaded.removeHandler(e)}},{key:"addSilentRenewError",value:function(e){return this._silentRenewError.addHandler(e)}},{key:"removeSilentRenewError",value:function(e){return this._silentRenewError.removeHandler(e)}},{key:"_raiseSilentRenewError",value:(s=b(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._silentRenewError.raise(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"addUserSignedIn",value:function(e){return this._userSignedIn.addHandler(e)}},{key:"removeUserSignedIn",value:function(e){this._userSignedIn.removeHandler(e)}},{key:"_raiseUserSignedIn",value:(i=b(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._userSignedIn.raise();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"addUserSignedOut",value:function(e){return this._userSignedOut.addHandler(e)}},{key:"removeUserSignedOut",value:function(e){this._userSignedOut.removeHandler(e)}},{key:"_raiseUserSignedOut",value:(n=b(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._userSignedOut.raise();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addUserSessionChanged",value:function(e){return this._userSessionChanged.addHandler(e)}},{key:"removeUserSessionChanged",value:function(e){this._userSessionChanged.removeHandler(e)}},{key:"_raiseUserSessionChanged",value:(r=b(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._userSessionChanged.raise();case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}]),t}(G),Te=function(){function e(t){var r=this;R(this,e),this._userManager=t,this._logger=new q("SilentRenewService"),this._isStarted=!1,this._retryTimer=new K("Retry Silent Renew"),this._tokenExpiring=b(m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r._logger.create("_tokenExpiring"),e.prev=1,e.next=4,r._userManager.signinSilent();case 4:t.debug("silent token renewal successful"),e.next=16;break;case 7:if(e.prev=7,e.t0=e.catch(1),!(e.t0 instanceof D)){e.next=13;break}return t.warn("ErrorTimeout from signinSilent:",e.t0,"retry in 5s"),r._retryTimer.init(5),e.abrupt("return");case 13:return t.error("Error from signinSilent:",e.t0),e.next=16,r._userManager.events._raiseSilentRenewError(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,7]])})))}var t;return I(e,[{key:"start",value:(t=b(m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._logger.create("start"),this._isStarted){e.next=13;break}return this._isStarted=!0,this._userManager.events.addAccessTokenExpiring(this._tokenExpiring),this._retryTimer.addHandler(this._tokenExpiring),e.prev=5,e.next=8,this._userManager.getUser();case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),t.error("getUser error",e.t0);case 13:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(){return t.apply(this,arguments)})},{key:"stop",value:function(){this._isStarted&&(this._retryTimer.cancel(),this._retryTimer.removeHandler(this._tokenExpiring),this._userManager.events.removeAccessTokenExpiring(this._tokenExpiring),this._isStarted=!1)}}]),e}(),Ie=I((function e(t){R(this,e),this.refresh_token=t.refresh_token,this.id_token=t.id_token,this.session_state=t.session_state,this.scope=t.scope,this.profile=t.profile,this.data=t.state}));d("U",function(){function e(t,r,n,i){R(this,e),this._logger=new q("UserManager"),this.settings=new ye(t),this._client=new pe(t),this._redirectNavigator=null!=r?r:new Se(this.settings),this._popupNavigator=null!=n?n:new xe(this.settings),this._iframeNavigator=null!=i?i:new ke(this.settings),this._events=new Ee(this.settings),this._silentRenewService=new Te(this),this.settings.automaticSilentRenew&&this.startSilentRenew(),this._sessionMonitor=null,this.settings.monitorSession&&(this._sessionMonitor=new de(this))}var t,r,n,i,p,d,g,v,w,k,x,S,E,T,O,P,C,U,j,A,N,M,L,H,W,F,K,J,D,G,Q;return I(e,[{key:"events",get:function(){return this._events}},{key:"metadataService",get:function(){return this._client.metadataService}},{key:"getUser",value:(Q=b(m().mark((function e(){var t,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._logger.create("getUser"),e.next=3,this._loadUser();case 3:if(!(r=e.sent)){e.next=9;break}return t.info("user loaded"),e.next=8,this._events.load(r,!1);case 8:return e.abrupt("return",r);case 9:return t.info("user not found in storage"),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this)}))),function(){return Q.apply(this,arguments)})},{key:"removeUser",value:(G=b(m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._logger.create("removeUser"),e.next=3,this.storeUser(null);case 3:return t.info("user removed from storage"),e.next=6,this._events.unload();case 6:case"end":return e.stop()}}),e,this)}))),function(){return G.apply(this,arguments)})},{key:"signinRedirect",value:(D=b(m().mark((function e(){var t,r,n,i,a=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},this._logger.create("signinRedirect"),r=t.redirectMethod,n=_(t,s),e.next=5,this._redirectNavigator.prepare({redirectMethod:r});case 5:return i=e.sent,e.next=8,this._signinStart(f({request_type:"si:r"},n),i);case 8:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"signinRedirectCallback",value:(J=b(m().mark((function e(){var t,r,n,i=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:window.location.href,r=this._logger.create("signinRedirectCallback"),e.next=4,this._signinEnd(t);case 4:return(n=e.sent).profile&&n.profile.sub?r.info("success, signed in subject",n.profile.sub):r.info("no subject"),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(){return J.apply(this,arguments)})},{key:"signinResourceOwnerCredentials",value:(K=b(m().mark((function e(t){var r,n,i,s,a,o,c;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.username,n=t.password,i=t.skipUserInfo,s=void 0!==i&&i,a=this._logger.create("signinResourceOwnerCredential"),e.next=4,this._client.processResourceOwnerPasswordCredentials({username:r,password:n,skipUserInfo:s,extraTokenParams:this.settings.extraTokenParams});case 4:return o=e.sent,a.debug("got signin response"),e.next=8,this._buildUser(o);case 8:return(c=e.sent).profile&&c.profile.sub?a.info("success, signed in subject",c.profile.sub):a.info("no subject"),e.abrupt("return",c);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"signinPopup",value:(F=b(m().mark((function e(){var t,r,n,i,s,o,c,u,l=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:{},r=this._logger.create("signinPopup"),n=t.popupWindowFeatures,i=t.popupWindowTarget,s=_(t,a),(o=this.settings.popup_redirect_uri)||r.throw(new Error("No popup_redirect_uri configured")),e.next=7,this._popupNavigator.prepare({popupWindowFeatures:n,popupWindowTarget:i});case 7:return c=e.sent,e.next=10,this._signin(f({request_type:"si:p",redirect_uri:o,display:"popup"},s),c);case 10:return(u=e.sent)&&(u.profile&&u.profile.sub?r.info("success, signed in subject",u.profile.sub):r.info("no subject")),e.abrupt("return",u);case 13:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"signinPopupCallback",value:(W=b(m().mark((function e(){var t,r,n,i=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:window.location.href,r=i.length>1&&void 0!==i[1]&&i[1],n=this._logger.create("signinPopupCallback"),e.next=5,this._popupNavigator.callback(t,{keepOpen:r});case 5:n.info("success");case 6:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"signinSilent",value:(H=b(m().mark((function e(){var t,r,n,i,s,a,c,u,l,h,p=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},n=this._logger.create("signinSilent"),i=t.silentRequestTimeoutInSeconds,s=_(t,o),e.next=5,this._loadUser();case 5:if(!(null==(a=e.sent)?void 0:a.refresh_token)){e.next=12;break}return n.debug("using refresh token"),c=new Ie(a),e.next=11,this._useRefreshToken({state:c,redirect_uri:s.redirect_uri,resource:s.resource,extraTokenParams:s.extraTokenParams,timeoutInSeconds:i});case 11:return e.abrupt("return",e.sent);case 12:return(u=this.settings.silent_redirect_uri)||n.throw(new Error("No silent_redirect_uri configured")),a&&this.settings.validateSubOnSilentRenew&&(n.debug("subject prior to silent renew:",a.profile.sub),l=a.profile.sub),e.next=17,this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:i});case 17:return h=e.sent,e.next=20,this._signin(f({request_type:"si:s",redirect_uri:u,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?null==a?void 0:a.id_token:void 0},s),h,l);case 20:return(a=e.sent)&&((null==(r=a.profile)?void 0:r.sub)?n.info("success, signed in subject",a.profile.sub):n.info("no subject")),e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,this)}))),function(){return H.apply(this,arguments)})},{key:"_useRefreshToken",value:(L=b(m().mark((function e(t){var r,n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._client.useRefreshToken(f(f({},t),{},{timeoutInSeconds:this.settings.silentRequestTimeoutInSeconds}));case 2:return r=e.sent,n=new fe(f(f({},t.state),r)),e.next=6,this.storeUser(n);case 6:return e.next=8,this._events.load(n);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"signinSilentCallback",value:(M=b(m().mark((function e(){var t,r,n=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:window.location.href,r=this._logger.create("signinSilentCallback"),e.next=4,this._iframeNavigator.callback(t);case 4:r.info("success");case 5:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"signinCallback",value:(N=b(m().mark((function e(){var t,r,n,i=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:window.location.href,e.next=3,this._client.readSigninResponseState(t);case 3:r=e.sent,n=r.state,e.t0=n.request_type,e.next="si:r"===e.t0?8:"si:p"===e.t0?11:"si:s"===e.t0?14:17;break;case 8:return e.next=10,this.signinRedirectCallback(t);case 10:case 13:case 16:return e.abrupt("return",e.sent);case 11:return e.next=13,this.signinPopupCallback(t);case 14:return e.next=16,this.signinSilentCallback(t);case 17:throw new Error("invalid response_type in state");case 18:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"signoutCallback",value:(A=b(m().mark((function e(){var t,r,n,i,s=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:window.location.href,r=s.length>1&&void 0!==s[1]&&s[1],e.next=4,this._client.readSignoutResponseState(t);case 4:if(n=e.sent,i=n.state){e.next=8;break}return e.abrupt("return");case 8:e.t0=i.request_type,e.next="so:r"===e.t0?11:"so:p"===e.t0?14:"so:s"===e.t0?17:20;break;case 11:return e.next=13,this.signoutRedirectCallback(t);case 13:case 16:case 19:return e.abrupt("break",21);case 14:return e.next=16,this.signoutPopupCallback(t,r);case 17:return e.next=19,this.signoutSilentCallback(t);case 20:throw new Error("invalid response_type in state");case 21:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"querySessionStatus",value:(j=b(m().mark((function e(){var t,r,n,i,s,a,o,u,l,h=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:{},r=this._logger.create("querySessionStatus"),n=t.silentRequestTimeoutInSeconds,i=_(t,c),(s=this.settings.silent_redirect_uri)||r.throw(new Error("No silent_redirect_uri configured")),e.next=7,this._loadUser();case 7:return a=e.sent,e.next=10,this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:n});case 10:return o=e.sent,e.next=13,this._signinStart(f({request_type:"si:s",redirect_uri:s,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?null==a?void 0:a.id_token:void 0,response_type:this.settings.query_status_response_type,scope:"openid",skipUserInfo:!0},i),o);case 13:return u=e.sent,e.prev=14,e.next=17,this._client.processSigninResponse(u.url);case 17:if(l=e.sent,r.debug("got signin response"),!l.session_state||!l.profile.sub){e.next=22;break}return r.info("success for subject",l.profile.sub),e.abrupt("return",{session_state:l.session_state,sub:l.profile.sub});case 22:return r.info("success, user not authenticated"),e.abrupt("return",null);case 26:if(e.prev=26,e.t0=e.catch(14),!(this.settings.monitorAnonymousSession&&e.t0 instanceof z)){e.next=34;break}e.t1=e.t0.error,e.next="login_required"===e.t1||"consent_required"===e.t1||"interaction_required"===e.t1||"account_selection_required"===e.t1?32:34;break;case 32:return r.info("success for anonymous user"),e.abrupt("return",{session_state:e.t0.session_state});case 34:throw e.t0;case 35:case"end":return e.stop()}}),e,this,[[14,26]])}))),function(){return j.apply(this,arguments)})},{key:"_signin",value:(U=b(m().mark((function e(t,r,n){var i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._signinStart(t,r);case 2:return i=e.sent,e.next=5,this._signinEnd(i.url,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return U.apply(this,arguments)})},{key:"_signinStart",value:(C=b(m().mark((function e(t,r){var n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._logger.create("_signinStart"),e.prev=1,e.next=4,this._client.createSigninRequest(t);case 4:return i=e.sent,n.debug("got signin request"),e.next=8,r.navigate({url:i.url,state:i.state.id,response_mode:i.state.response_mode,scriptOrigin:this.settings.iframeScriptOrigin});case 8:return e.abrupt("return",e.sent);case 11:throw e.prev=11,e.t0=e.catch(1),n.debug("error after preparing navigator, closing navigator window"),r.close(),e.t0;case 16:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(e,t){return C.apply(this,arguments)})},{key:"_signinEnd",value:(P=b(m().mark((function e(t,r){var n,i,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._logger.create("_signinEnd"),e.next=3,this._client.processSigninResponse(t);case 3:return i=e.sent,n.debug("got signin response"),e.next=7,this._buildUser(i,r);case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"_buildUser",value:(O=b(m().mark((function e(t,r){var n,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._logger.create("_buildUser"),i=new fe(t),!r){e.next=7;break}if(r===i.profile.sub){e.next=6;break}throw n.debug("current user does not match user returned from signin. sub from signin:",i.profile.sub),new z(f(f({},t),{},{error:"login_required"}));case 6:n.debug("current user matches user returned from signin");case 7:return e.next=9,this.storeUser(i);case 9:return n.debug("user stored"),e.next=12,this._events.load(i);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"signoutRedirect",value:(T=b(m().mark((function e(){var t,r,n,i,s,a=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=this._logger.create("signoutRedirect"),n=t.redirectMethod,i=_(t,u),e.next=5,this._redirectNavigator.prepare({redirectMethod:n});case 5:return s=e.sent,e.next=8,this._signoutStart(f({request_type:"so:r",post_logout_redirect_uri:this.settings.post_logout_redirect_uri},i),s);case 8:r.info("success");case 9:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"signoutRedirectCallback",value:(E=b(m().mark((function e(){var t,r,n,i=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:window.location.href,r=this._logger.create("signoutRedirectCallback"),e.next=4,this._signoutEnd(t);case 4:return n=e.sent,r.info("success"),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"signoutPopup",value:(S=b(m().mark((function e(){var t,r,n,i,s,a,o,c=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},r=this._logger.create("signoutPopup"),n=t.popupWindowFeatures,i=t.popupWindowTarget,s=_(t,l),a=this.settings.popup_post_logout_redirect_uri,e.next=6,this._popupNavigator.prepare({popupWindowFeatures:n,popupWindowTarget:i});case 6:return o=e.sent,e.next=9,this._signout(f({request_type:"so:p",post_logout_redirect_uri:a,state:null==a?void 0:{}},s),o);case 9:r.info("success");case 10:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"signoutPopupCallback",value:(x=b(m().mark((function e(){var t,r,n,i=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:window.location.href,r=i.length>1&&void 0!==i[1]&&i[1],n=this._logger.create("signoutPopupCallback"),e.next=5,this._popupNavigator.callback(t,{keepOpen:r});case 5:n.info("success");case 6:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"_signout",value:(k=b(m().mark((function e(t,r){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._signoutStart(t,r);case 2:return n=e.sent,e.next=5,this._signoutEnd(n.url);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"_signoutStart",value:(w=b(m().mark((function e(){var t,r,n,i,s,a,o,c=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},r=c.length>1?c[1]:void 0,i=this._logger.create("_signoutStart"),e.prev=3,e.next=6,this._loadUser();case 6:if(s=e.sent,i.debug("loaded current user from storage"),!this.settings.revokeTokensOnSignout){e.next=11;break}return e.next=11,this._revokeInternal(s);case 11:return(a=t.id_token_hint||s&&s.id_token)&&(i.debug("setting id_token_hint in signout request"),t.id_token_hint=a),e.next=15,this.removeUser();case 15:return i.debug("user removed, creating signout request"),e.next=18,this._client.createSignoutRequest(t);case 18:return o=e.sent,i.debug("got signout request"),e.next=22,r.navigate({url:o.url,state:null==(n=o.state)?void 0:n.id,scriptOrigin:this.settings.iframeScriptOrigin});case 22:return e.abrupt("return",e.sent);case 25:throw e.prev=25,e.t0=e.catch(3),i.debug("error after preparing navigator, closing navigator window"),r.close(),e.t0;case 30:case"end":return e.stop()}}),e,this,[[3,25]])}))),function(){return w.apply(this,arguments)})},{key:"_signoutEnd",value:(v=b(m().mark((function e(t){var r,n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._logger.create("_signoutEnd"),e.next=3,this._client.processSignoutResponse(t);case 3:return n=e.sent,r.debug("got signout response"),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"signoutSilent",value:(g=b(m().mark((function e(){var t,r,n,i,s,a,o,c,u=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},n=this._logger.create("signoutSilent"),i=t.silentRequestTimeoutInSeconds,s=_(t,h),!this.settings.includeIdTokenInSilentSignout){e.next=15;break}return e.next=6,this._loadUser();case 6:if(e.t1=r=e.sent,null!=e.t1){e.next=11;break}e.t2=void 0,e.next=12;break;case 11:e.t2=r.id_token;case 12:e.t0=e.t2,e.next=16;break;case 15:e.t0=void 0;case 16:return a=e.t0,o=this.settings.popup_post_logout_redirect_uri,e.next=20,this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:i});case 20:return c=e.sent,e.next=23,this._signout(f({request_type:"so:s",post_logout_redirect_uri:o,id_token_hint:a},s),c);case 23:n.info("success");case 24:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"signoutSilentCallback",value:(d=b(m().mark((function e(){var t,r,n=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:window.location.href,r=this._logger.create("signoutSilentCallback"),e.next=4,this._iframeNavigator.callback(t);case 4:r.info("success");case 5:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"revokeTokens",value:(p=b(m().mark((function e(t){var r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._loadUser();case 2:return r=e.sent,e.next=5,this._revokeInternal(r,t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"_revokeInternal",value:(i=b(m().mark((function e(t){var r,n,i,s,a,o,c=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:this.settings.revokeTokenTypes,n=this._logger.create("_revokeInternal"),t){e.next=4;break}return e.abrupt("return");case 4:if(i=r.filter((function(e){return"string"==typeof t[e]})),i.length){e.next=8;break}return n.debug("no need to revoke due to no token(s)"),e.abrupt("return");case 8:s=y(i),e.prev=9,s.s();case 11:if((a=s.n()).done){e.next=19;break}return o=a.value,e.next=15,this._client.revokeToken(t[o],o);case 15:n.info("".concat(o," revoked successfully")),"access_token"!==o&&(t[o]=null);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),s.e(e.t0);case 24:return e.prev=24,s.f(),e.finish(24);case 27:return e.next=29,this.storeUser(t);case 29:return n.debug("user stored"),e.next=32,this._events.load(t);case 32:case"end":return e.stop()}}),e,this,[[9,21,24,27]])}))),function(e){return i.apply(this,arguments)})},{key:"startSilentRenew",value:function(){this._logger.create("startSilentRenew"),this._silentRenewService.start()}},{key:"stopSilentRenew",value:function(){this._silentRenewService.stop()}},{key:"_userStoreKey",get:function(){return"user:".concat(this.settings.authority,":").concat(this.settings.client_id)}},{key:"_loadUser",value:(n=b(m().mark((function e(){var t,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._logger.create("_loadUser"),e.next=3,this.settings.userStore.get(this._userStoreKey);case 3:if(!(r=e.sent)){e.next=7;break}return t.debug("user storageString loaded"),e.abrupt("return",fe.fromStorageString(r));case 7:return t.debug("no user storageString"),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"storeUser",value:(r=b(m().mark((function e(t){var r,n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._logger.create("storeUser"),!t){e.next=8;break}return r.debug("storing user"),n=t.toStorageString(),e.next=6,this.settings.userStore.set(this._userStoreKey,n);case 6:e.next=11;break;case 8:return this._logger.debug("removing user"),e.next=11,this.settings.userStore.remove(this._userStoreKey);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"clearStaleState",value:(t=b(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._client.clearStaleState();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}());A.setLogger(console),A.setLevel(A.INFO);d("s",{authority:"https://localhost:5443",client_id:"interactive",client_secret:"ClientSecret1",redirect_uri:"http://localhost:4100/signin-oidc",response_type:"code",scope:"openid profile CoffeeAPI.read offline_access",silent_redirect_uri:"http://localhost:4100/silent-renew",automaticSilentRenew:!0})}}}))}();
